<!DOCTYPE html><html class="theme-lattice"><head><meta charset="utf-8"><title>feWorkflow - 使用electron, react, redux, immutable构建桌面App | Aotu.io「凹凸实验室」</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="凹凸实验室"><meta name="designer" content="凹凸实验室"><meta name="rating" content="general"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="index, follow"><meta name="keywords" content="Electron,React,凹凸实验室,Aotu,前端开发,全栈开发,IOS开发,Android开发"><link rel="canonical" href="https://aotu.io/notes/2016/07/05/fe-workflow/index.html"><link rel="apple-touch-icon" sizes="57x57" href="/img/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="144x144" href="/img/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="60x60" href="/img/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="120x120" href="/img/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="152x152" href="/img/apple-touch-icon-152x152.png"><link rel="icon" type="image/png" href="/img/favicon-230x230.png" sizes="230x230"><link rel="icon" type="image/png" href="/img/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16"><link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32"><meta name="msapplication-TileColor" content="#2f83cd"><meta name="msapplication-TileImage" content="/img/mstile-144x144.png"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" href="/atom.xml" title="Aotu.io"><meta name="description" content="15年初创建了适用于目前团队的gulp工作流，旨在以一个gulpfile来操作和执行所有文件结构。随着项目依赖滚雪球式的增长，拉取npm包成了配置中最麻烦而极容易出错的一项。为了解决配置过程中遇到的种种问题，15年底草草实现了一个方案，用nw.js（基于Chromium和node.js的app执行工具）框架来编写了一个简单的桌面应用gulp-ui, 所做的操作是打包gulpfile和所依赖的所有n"><meta property="og:type" content="article"><meta property="og:title" content="feWorkflow - 使用electron, react, redux, immutable构建桌面App"><meta property="og:url" content="https://aotu.io/notes/2016/07/05/fe-workflow/index.html"><meta property="og:site_name" content="Aotu.io"><meta property="og:description" content="15年初创建了适用于目前团队的gulp工作流，旨在以一个gulpfile来操作和执行所有文件结构。随着项目依赖滚雪球式的增长，拉取npm包成了配置中最麻烦而极容易出错的一项。为了解决配置过程中遇到的种种问题，15年底草草实现了一个方案，用nw.js（基于Chromium和node.js的app执行工具）框架来编写了一个简单的桌面应用gulp-ui, 所做的操作是打包gulpfile和所依赖的所有n"><meta property="og:image" content="https://sfault-image.b0.upaiyun.com/254/455/2544556661-577b5347d97a0_articlex"><meta property="og:image" content="https://segmentfault.com/img/bVyPyt"><meta property="og:image" content="https://segmentfault.com/img/bVyPyi"><meta property="og:updated_time" content="2016-10-20T07:06:32.427Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="feWorkflow - 使用electron, react, redux, immutable构建桌面App"><meta name="twitter:description" content="15年初创建了适用于目前团队的gulp工作流，旨在以一个gulpfile来操作和执行所有文件结构。随着项目依赖滚雪球式的增长，拉取npm包成了配置中最麻烦而极容易出错的一项。为了解决配置过程中遇到的种种问题，15年底草草实现了一个方案，用nw.js（基于Chromium和node.js的app执行工具）框架来编写了一个简单的桌面应用gulp-ui, 所做的操作是打包gulpfile和所依赖的所有n"><meta name="twitter:image" content="https://sfault-image.b0.upaiyun.com/254/455/2544556661-577b5347d97a0_articlex"><meta name="twitter:site" content="o2circle"><script>var App={root:"/",isHome:!1,isCate:!1,isTag:!1}</script></head><body class="page-post-detail"><div class="mod-hd"><div class="grid"><div class="mod-logo"><a href="/index.html" title="Aotu.io">Aotu.io</a></div><span class="mod-hd-toggle" id="J_hdToggle"><i class="fa fa-bars"></i></span><div class="mod-hd-main"><div class="mod-hd-inner"><nav class="mod-nav"><ul class="mod-nav-list"><li class="main-nav-item"><a href="/index.html" class="main-nav-link">首页</a></li><li class="main-nav-item"><a href="/about/" class="main-nav-link">关于</a></li><li class="main-nav-item"><a href="/join/" class="main-nav-link">加入我们</a></li></ul></nav><div class="mod-search"><a class="fa fa-search mod-search-ico" id="J_searchTrigger" title="搜索"></a><form id="J_searchForm" method="get" class="mod-search-form" action="/search/"><input type="text" name="query" class="mod-search-ipt" id="J_searchInput" placeholder="搜索"></form></div></div></div></div></div><div class="mod-container"><div class="grid"><div class="mod-main"><article class="post"><header class="post-hd"><h2 class="post-tit">feWorkflow - 使用electron, react, redux, immutable构建桌面App</h2><div class="post-meta">by <a target="_blank" href="https://github.com/whatifhappen" class="post-author">whatif</a> on <span>2016-07-05</span></div><p class="post-subtit" style="display:none"><i class="fa fa-quote-left"></i>使用react, redux, immutable框架做ui开发，仍然基于运行gulpfile的方案，这样可以使每个使用自己团队的gulp工作流快速接入和自由调整。</p><span style="display:none" id="busuanzi_value_page_pv"></span></header><div class="post-cover"><img src="//img.aotu.io/FqMe96r-4Spj-juPOP-rH50-oaKX" alt="feWorkflow - 使用electron, react, redux, immutable构建桌面App"></div><div class="post-content"><p>15年初创建了适用于目前团队的gulp工作流，旨在以一个gulpfile来操作和执行所有文件结构。随着项目依赖滚雪球式的增长，拉取npm包成了配置中最麻烦而极容易出错的一项。为了解决配置过程中遇到的种种问题，15年底草草实现了一个方案，用nw.js（基于Chromium和node.js的app执行工具）框架来编写了一个简单的桌面应用<a href="http://whatifhappen.github.io/GulpUI-WX/" target="_blank" rel="external">gulp-ui</a>, 所做的操作是打包gulpfile和所依赖的所有node_modules在一起，然后简单粗暴的在app内部执行gulpfile。</p><a id="more"></a><p><a href="http://whatifhappen.github.io/GulpUI-WX/" target="_blank" rel="external">gulp-ui</a>做出来后再团队中使用了一段时间，以单个项目来执行的方式确实在经常多项目开发的使用环境中多有不便。于是在这个基础上，重写了整个代码结构，开发了现在的版本feWorkflow.</p><p><a href="http://whatifhappen.github.io/GulpUI-WX/" target="_blank" rel="external">feWorkflow</a>改用了electron做为底层，使用react, redux, immutable框架做ui开发，仍然基于运行gulpfile的方案，这样可以使每个使用自己团队的gulp工作流快速接入和自由调整。</p><p><img src="https://sfault-image.b0.upaiyun.com/254/455/2544556661-577b5347d97a0_articlex" alt="feWorkflow"></p><h2 id="功能" class="post-heading"><a href="#功能" class="headerlink" title="功能"></a>功能<a class="post-anchor" href="#功能" aria-hidden="true"></a></h2><h3 id="一键式开发-压缩" class="post-heading"><a href="#一键式开发-压缩" class="headerlink" title="一键式开发/压缩"></a>一键式开发/压缩<a class="post-anchor" href="#一键式开发-压缩" aria-hidden="true"></a></h3><ul><li>less实时监听编译css</li><li>css前缀自动补全</li><li>格式化html，并自动替换src源码路径为tc_idc发布路径</li><li>压缩图片(png|jpg|gif|svg)</li><li>压缩或格式化js，并自动替换src源码路径为tc_idc发布路径</li><li>同步刷新浏览器browserSync</li></ul><h2 id="框架选型" class="post-heading"><a href="#框架选型" class="headerlink" title="框架选型"></a>框架选型<a class="post-anchor" href="#框架选型" aria-hidden="true"></a></h2><h3 id="electron" class="post-heading"><a href="#electron" class="headerlink" title="electron"></a>electron<a class="post-anchor" href="#electron" aria-hidden="true"></a></h3><p>与 NW.js 相似，Electron 提供了一个能通过 JavaScript 和 HTML 创建桌面应用的平台，同时集成 Node 来授予网页访问底层系统的权限。</p><p>使用nw.js时遇到了很多问题，设置和api比较繁琐，于是改版过程用再开发便利性上的考虑转用了electron。</p><p>electron应用布署非常简单，存放应用程序的文件夹需要叫做 <code>app</code> 并且需要放在 Electron 的 资源文件夹下（在 macOS 中是指 <code>Electron.app/Contents/Resources/</code>，在 Linux 和 Windows 中是指 <code>resources/</code>） 就像这样：</p><p>macOS:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">electron/Electron.app/Contents/Resources/app/</div><div class="line">├── package.json</div><div class="line">├── main.js</div><div class="line">└── index.html</div></pre></td></tr></table></figure><p>在 Windows 和 Linux 中:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">electron/resources/app</div><div class="line">├── package.json</div><div class="line">├── main.js</div><div class="line">└── index.html</div></pre></td></tr></table></figure><p>然后运行 <code>Electron.app</code> （或者 Linux 中的 <code>electron</code>，Windows 中的 <code>electron.exe</code>）, 接着 Electron 就会以你的应用程序的方式启动。</p><h5 id="目录释义" class="post-heading"><a href="#目录释义" class="headerlink" title="目录释义"></a>目录释义<a class="post-anchor" href="#目录释义" aria-hidden="true"></a></h5><p><code>package.json</code>主要用来指定app的名称，版本，入口文件，依赖文件等</p><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>    : <span class="string">"your-app"</span>,</div><div class="line">  <span class="attr">"version"</span> : <span class="string">"0.1.0"</span>,</div><div class="line">  <span class="attr">"main"</span>    : <span class="string">"main.js"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p><code>main.js</code> 应该用于创建窗口和处理系统事件，官方也是推荐使用<code>es6</code>来开发，典型的例子如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> electron = <span class="built_in">require</span>(<span class="string">'electron'</span>);</div><div class="line"><span class="comment">//引入app模块</span></div><div class="line"><span class="keyword">const</span> &#123;app&#125; = electron;</div><div class="line"><span class="comment">// 引入窗口视图</span></div><div class="line"><span class="keyword">const</span> &#123;BrowserWindow&#125; = electron;</div><div class="line"><span class="comment">//设置一个变量</span></div><div class="line"><span class="keyword">let</span> mainWindow;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createWindow</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="comment">//实例化一个新的窗口</span></div><div class="line">  mainWindow = <span class="keyword">new</span> BrowserWindow(&#123;<span class="attr">width</span>: <span class="number">800</span>, <span class="attr">height</span>: <span class="number">600</span>&#125;);</div><div class="line"></div><div class="line">  <span class="comment">//加载electron主页面</span></div><div class="line">  mainWindow.loadURL(<span class="string">`file://<span class="subst">$&#123;__dirname&#125;</span>/index.html`</span>);</div><div class="line"></div><div class="line">  <span class="comment">//打开chrome开发者工具</span></div><div class="line">  mainWindow.webContents.openDevTools();</div><div class="line"></div><div class="line">  <span class="comment">//监听窗口关闭状态</span></div><div class="line">  mainWindow.on(<span class="string">'closed'</span>, () =&gt; &#123;</div><div class="line">    mainWindow = <span class="literal">null</span>;</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line"><span class="comment">//当app初始化完毕，开始创建一个新窗口</span></div><div class="line">app.on(<span class="string">'ready'</span>, createWindow);</div><div class="line"></div><div class="line"><span class="comment">//监听app窗口关闭状态</span></div><div class="line">app.on(<span class="string">'window-all-closed'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">//mac osx中只有执行command+Q才会退出app，否则保持活动状态</span></div><div class="line">  <span class="keyword">if</span> (process.platform !== <span class="string">'darwin'</span>) &#123;</div><div class="line">    app.quit();</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.on(<span class="string">'activate'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">//mac osx中再dock图标点击时重新创建一个窗口</span></div><div class="line">  <span class="keyword">if</span> (mainWindow === <span class="literal">null</span>) &#123;</div><div class="line">    createWindow();</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p><code>index.html</code>则用来输出你的html：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    We are using node <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">document</span>.write(process.versions.node)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>,</div><div class="line">    Chrome <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">document</span>.write(process.versions.chrome)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>,</div><div class="line">    and Electron <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">document</span>.write(process.versions.electron)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>.</div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure><p>electron官方提供了一个快速开始的模板：</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># Clone the Quick Start repository</div><div class="line">$ git clone https://github.com/electron/electron-quick-start</div><div class="line"></div><div class="line"># Go into the repository</div><div class="line">$ cd electron-quick-start</div><div class="line"></div><div class="line"># Install the dependencies and run</div><div class="line">$ npm install &amp;&amp; npm start</div></pre></td></tr></table></figure><p>更多入门介绍可以查看这里<a href="https://github.com/electron/electron/blob/master/docs-translations/zh-CN/tutorial/quick-start.md" target="_blank" rel="external">Electron快速入门</a>.</p><hr><h3 id="React-ES6" class="post-heading"><a href="#React-ES6" class="headerlink" title="React + ES6"></a>React + ES6<a class="post-anchor" href="#React-ES6" aria-hidden="true"></a></h3><p>React做为一个用来构建UI的JS库开辟了一个相当另类的途径，实现了前端界面的高效率高性能开发。React的虚拟DOM不仅带来了简单的UI开发逻辑，同时也带来了组件化开发的思想。</p><p>ES6做为js的新规范带来了许多新的变化，从代码的编写上也带来了许多的便利性。</p><p>一个简单的<code>react</code>模块示例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//jsx</span></div><div class="line"><span class="keyword">var</span> HelloMessage = React.createClass(&#123;</div><div class="line">  <span class="attr">render</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">HelloMessage</span> <span class="attr">name</span>=<span class="string">"John"</span> /&gt;</span>, document.getElementById('root')));</span></div></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//html</div><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//实际输出</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span>Hello John<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure><p>通过<code>React.createClass</code>创建一个<code>react</code>模块，使用<code>render</code>函数返回这个模块中的实际html模板，然后引用<code>ReactDOM</code>的<code>render</code>函数生成到指定的html模块中。调用<code>HelloMessage</code>的方法，则是写成一个<code>xhtml</code>的形式<code>&lt;HelloMessage name=&quot;John&quot; /&gt;</code>，将<code>name</code>里面的”John”做为一个属性值传到<code>HelloMessage</code>中，通过<code>this.props.name</code>来调用。</p><p>当然，这个是未经编译的<code>jsx</code>文件，不能实际输出到html中，如果想要未经编译使用<code>jsx</code>文件，可以在<code>html</code>中引用<code>babel</code>的组件，例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello React!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"build/react.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"build/react-dom.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"example"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/babel"</span>&gt;</span><span class="javascript"></span></div><div class="line">      ReactDOM.render(</div><div class="line">        <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, world!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>,</div><div class="line">        <span class="built_in">document</span>.getElementById(<span class="string">'example'</span>)</div><div class="line">      );</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure><p>自从<code>es6</code>正式发布后，<code>react</code>也改用了<code>babel</code>做为编译工具，也因此许多开发者开始将代码开发风格项<code>es6</code>转变。</p><p>于是<code>React.createClass</code>的方法被取代为es6中的扩展类写法：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>我们可以看到这些语法有了细微的不同：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ES5的写法</span></div><div class="line"><span class="keyword">var</span> HelloWorld = React.createClass(&#123;</div><div class="line">  <span class="attr">handleClick</span>: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;...&#125;,</div><div class="line">  <span class="attr">render</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;...&#125;,</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">//ES6及以上写法</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  handleClick(e) &#123;...&#125;</div><div class="line">  render() &#123;...&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>在feWorkflow中基本都是使用ES6的写法做为开发, 例如最终输出的container模块：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> ListFolder <span class="keyword">from</span> <span class="string">'./list/list'</span>;</div><div class="line"><span class="keyword">import</span> Dropzone <span class="keyword">from</span> <span class="string">'./layout/dropzone'</span>;</div><div class="line"><span class="keyword">import</span> ContainerEmpty <span class="keyword">from</span> <span class="string">'./container-empty'</span>;</div><div class="line"><span class="keyword">import</span> ContainerFt <span class="keyword">from</span> <span class="string">'./layout/container-ft'</span>;</div><div class="line"><span class="keyword">import</span> Aside <span class="keyword">from</span> <span class="string">'./layout/aside'</span>;</div><div class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> Container = <span class="function">(<span class="params">&#123; lists &#125;</span>) =&gt;</span> (</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"container"</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"container-bd"</span>&gt;</span></div><div class="line">      &#123;lists.size ? <span class="tag">&lt;<span class="name">ListFolder</span> /&gt;</span> : <span class="tag">&lt;<span class="name">ContainerEmpty</span> /&gt;</span>&#125;</div><div class="line">      <span class="tag">&lt;<span class="name">Dropzone</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ContainerFt</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Aside</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">);</div><div class="line"></div><div class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">states</span>) =&gt;</span> (&#123;</div><div class="line">  <span class="attr">lists</span>: states.lists</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps)(Container);</div></pre></td></tr></table></figure><p>import做为ES6的引入方式，来取代commonJS的require模式，等同于</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ListFoder = <span class="built_in">require</span>(<span class="string">'./list/list'</span>);</div></pre></td></tr></table></figure><p>输出从<code>module.export = Container;</code> 替换成<code>export default Container;</code></p><p>这种写法其实等同于：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ES5写法</span></div><div class="line"><span class="keyword">var</span> Container = React.createClass(&#123;</div><div class="line">  <span class="attr">render</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">    ...</div><div class="line">    &#123;<span class="keyword">this</span>.props.lists.size ? <span class="xml"><span class="tag">&lt;<span class="name">ListFolder</span> /&gt;</span> : <span class="tag">&lt;<span class="name">ContainerEmpty</span> /&gt;</span>&#125;</span></div><div class="line">    ...</div><div class="line">  &#125;,</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p><code>{ lists }</code>的写法编译成ES5的写法等同于：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Container = <span class="function"><span class="keyword">function</span> <span class="title">Container</span>(<span class="params">_ref</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> lists = _ref.lists;</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>相当于减少了非常多的赋值操作, 极大了减少了开发的工作量。</p><hr><h3 id="Webpack" class="post-heading"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack<a class="post-anchor" href="#Webpack" aria-hidden="true"></a></h3><p>ES6中介绍了一下编译之后的代码，而每个文件里其实也并没有import必须的react模块，其实都是通过Webpack这个工具来执行了编译和打包。在webpack中引入了<code>babel-loader</code>来编译<code>react</code>和<code>es6</code>的代码，并将css通过<code>less-loader</code>,<code>css-loader</code>, <code>style-loader</code>自动编译到html的style标签中，再通过</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> webpack.ProvidePlugin(&#123;</div><div class="line">  <span class="attr">React</span>: <span class="string">'react'</span></div><div class="line">&#125;),</div></pre></td></tr></table></figure><p>的形式，将react组件注册到每个js文件中，不需再重复引用，最后把所有的js模块编译打包输出到<code>dist/bundle.js</code>，再html中引入即可。</p><p>流程图：</p><p><img src="https://segmentfault.com/img/bVyPyt" alt="wepback"></p><p>webpack部分设置：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="attr">devtool</span>: <span class="string">'source-map'</span>,</div><div class="line">  <span class="attr">entry</span>: [</div><div class="line">    <span class="string">'./src/index'</span></div><div class="line">  ],</div><div class="line">  <span class="attr">output</span>: &#123;</div><div class="line">    <span class="attr">path</span>: path.join(__dirname, <span class="string">'dist'</span>),</div><div class="line">    <span class="attr">filename</span>: <span class="string">'bundle.js'</span>,</div><div class="line">    <span class="attr">publicPath</span>: <span class="string">'/dist/'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">target</span>: <span class="string">'atom'</span>,</div><div class="line">  <span class="attr">module</span>: &#123;</div><div class="line">    <span class="attr">loaders</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</div><div class="line">        <span class="attr">include</span>: path.join(__dirname, <span class="string">'src'</span>),</div><div class="line">        <span class="attr">loader</span>: <span class="built_in">require</span>.resolve(<span class="string">'babel-loader'</span>),</div><div class="line">        ...</div><div class="line">      &#125;,</div><div class="line">   ...</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  ...</div><div class="line">&#125;;</div></pre></td></tr></table></figure><p>webpack需要设置入口文件<code>entry</code>，在此是引入了源码文件夹src中的<code>index.js</code>，和一个或多个出口文件<code>output</code>，输出devtool<code>source-map</code>使得源代码可见，而非编译后的代码，然后制定所需要的<code>loader</code>来做模块的编译。</p><p>与<code>electron</code>相关的一个比较重要的点是，必须指定<code>target: atom</code>，否则会出现无法resolve electron modules的报错提示。</p><p>更多介绍可以参考<a href="https://segmentfault.com/a/1190000002551952" target="_blank" rel="external">Webpack 入门指迷</a></p><p>feWorkflow项目中选用了<a href="https://github.com/gaearon/react-transform-hmr" target="_blank" rel="external">react-transform-hmr</a>做为模板，已经写好了基础的<code>webpack</code>文件，支持<code>react</code>热加载，不再需要经常去刷新electron，不过该作者已经停止维护这个项目，而是恢复维护<code>react-hot-reload</code>，现在重新开发<a href="https://github.com/gaearon/react-hot-loader/pull/240" target="_blank" rel="external">React Hot Loader 3</a>, 有兴趣可以去了解一下。</p><hr><h3 id="Redux" class="post-heading"><a href="#Redux" class="headerlink" title="Redux"></a>Redux<a class="post-anchor" href="#Redux" aria-hidden="true"></a></h3><p>Redux是针对JavaScript apps的一个可预见的state容器。它可以帮助我们写一个行为保持一致性的应用，可以运行再不同的环境中（client，server，和原生），并非常容易测试。</p><p>Redux 可以用这三个基本原则来描述：</p><ol><li><p><strong>单一数据源</strong></p><p><strong>整个应用的 state 被储存在一个 object tree 中，并且这个 object tree 只存在于唯一一个 store 中。</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> store = createStore(counter) <span class="comment">//创建一个redux store来保存你的app中所有state</span></div><div class="line"></div><div class="line"><span class="comment">//当state更新时，可以使用 subscribe()来绑定监听更新UI，通常情况下不会直接使用这个方法，而是会用view层绑定库（类似react-redux等)。</span></div><div class="line">store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span></div><div class="line">  <span class="built_in">console</span>.log(store.getState()) <span class="comment">//抛出所有数据</span></div><div class="line">)</div></pre></td></tr></table></figure></li><li><p><strong>State是只读的</strong></p><p>惟一改变 state 的方法就是触发 action，action 是一个用于描述已发生事件的普通对象。</p><p>所有的修改都被集中化处理，且严格按照一个接一个的顺序执行. 而执行的方法是调用<code>dispatch</code>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">store.dispatch(&#123;</div><div class="line">  <span class="attr">type</span>: <span class="string">'COMPLETE_TODO'</span>,</div><div class="line">  <span class="attr">index</span>: <span class="number">1</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></li><li><p><strong>使用纯函数来执行修改</strong></p><p>为了描述 action 如何改变 state tree ，你需要编写 <code>reducers</code>。</p><p><code>Reducer</code> 只是一些纯函数，它接收先前的 <code>state</code> 和 <code>action</code>，并返回新的 <code>state</code>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">counter</span>(<span class="params">state = <span class="number">0</span>, action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">  <span class="keyword">case</span> <span class="string">'INCREMENT'</span>:</div><div class="line">    <span class="keyword">return</span> state + <span class="number">1</span></div><div class="line">  <span class="keyword">case</span> <span class="string">'DECREMENT'</span>:</div><div class="line">    <span class="keyword">return</span> state - <span class="number">1</span></div><div class="line">  <span class="keyword">default</span>:</div><div class="line">    <span class="keyword">return</span> state</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ol><p>redux流程图：</p><p><img src="https://segmentfault.com/img/bVyPyi" alt="redux"></p><hr><h3 id="React-Redux" class="post-heading"><a href="#React-Redux" class="headerlink" title="React-Redux"></a>React-Redux<a class="post-anchor" href="#React-Redux" aria-hidden="true"></a></h3><p>redux在react中应用还需要加载<code>react-redux</code>模块，因为<code>store</code>为单一state结构头，我们仅需要在入口处调用react-redux的<code>Provider</code>方法抛出<code>store</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">render(</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">Container</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span>,</div><div class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</div><div class="line">);</div></pre></td></tr></table></figure><p>这样，在container的内部都能接收到<code>store</code>。</p><p>我们需要一个操作store的<code>reducer</code>. 当我们的reducer拆分好对应给不同的子组件之后，redux提供了一个<code>combineReducers</code>的方法，把所有的<code>reducers</code>合并起来:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="keyword">import</span> lists <span class="keyword">from</span> <span class="string">'./list'</span>;</div><div class="line"><span class="keyword">import</span> snackbar <span class="keyword">from</span> <span class="string">'./snackbar'</span>;</div><div class="line"><span class="keyword">import</span> dropzone <span class="keyword">from</span> <span class="string">'./dropzone'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123;</div><div class="line">  lists,</div><div class="line">  snackbar,</div><div class="line">  dropzone,</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>然后通过<code>createStore</code>的方式链接<code>store</code>与<code>reducer</code>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">'../reducer/reducer'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> createStore(reducer);</div></pre></td></tr></table></figure><p>上文介绍<code>redux</code>的时候也说过，<strong>state</strong>是只读的，只能通过action来操作，同样我们也可以把<code>dispatch</code>映射成为一个props传入Container中。</p><p>在子模块中, 则把这个store映射成react的props，再用<code>connect</code>方法，把store和component链接起来：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>; <span class="comment">//引入connect方法</span></div><div class="line"><span class="keyword">import</span> &#123; addList &#125; <span class="keyword">from</span> <span class="string">'../../action/addList'</span>; <span class="comment">//从action中引入addList方法</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> AddListBtn = <span class="function">(<span class="params">&#123; lists, addList &#125;</span>) =&gt;</span> (</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">FloatingActionButton</span></span></span></div><div class="line">    <span class="attr">onClick</span>=<span class="string">&#123;(event)</span> =&gt; &#123;</div><div class="line">        addList('do something here');</div><div class="line">      return false;</div><div class="line">      &#125;);</div><div class="line">    &#125;&#125;</div><div class="line">  &gt;;</div><div class="line">);</div><div class="line">const mapStateToProps = (states) =&gt; (&#123;</div><div class="line">  //从state.lists获取数据存储到lists中，做为属性传递给AddListBtn</div><div class="line">  lists: states.lists</div><div class="line">&#125;);</div><div class="line"></div><div class="line">const mapDispatchToProps = (dispatch) =&gt; (&#123;</div><div class="line">  //将addList函数做为属性传递给AddListBtn</div><div class="line">  addList: (name, location) =&gt; dispatch(addList(name, location));</div><div class="line">&#125;);</div><div class="line"></div><div class="line">//lists, addList做为属性链接到Conta</div><div class="line">export default connect(mapStateToProps, mapDispatchToProps)(AddListBtn);</div></pre></td></tr></table></figure><p>这样，就完成了redux与react的交互，很便捷的从上而下操作数据。</p><hr><h3 id="immutable-js" class="post-heading"><a href="#immutable-js" class="headerlink" title="immutable.js"></a>immutable.js<a class="post-anchor" href="#immutable-js" aria-hidden="true"></a></h3><p>Immutable Data是指一旦被创造后，就不可以被改变的数据。</p><p>通过使用Immutable Data，可以让我们更容易的去处理缓存、回退、数据变化检测等问题，简化我们的开发。</p><p>所以当对象的内容没有发生变化时，或者有一个新的对象进来时，我们倾向于保持对象引用的不变。这个工作正是我们需要借助Facebook的 <a href="https://github.com/facebook/immutable-js" target="_blank" rel="external">Immutable.js</a>来完成的。</p><blockquote><p>不变性意味着数据一旦创建就不能被改变，这使得应用开发更为简单，避免保护性拷贝（defensive copy），并且使得在简单的应用 逻辑中实现变化检查机制等。</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> stateV1 = Immutable.fromJS(&#123;  </div><div class="line"><span class="attr">users</span>: [</div><div class="line">  &#123; <span class="attr">name</span>: <span class="string">'Foo'</span> &#125;,</div><div class="line">  &#123; <span class="attr">name</span>: <span class="string">'Bar'</span> &#125;</div><div class="line">]</div><div class="line">&#125;);</div><div class="line"> </div><div class="line"><span class="keyword">var</span> stateV2 = stateV1.updateIn([<span class="string">'users'</span>, <span class="number">1</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  </div><div class="line">  <span class="keyword">return</span> Immutable.fromJS(&#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'Barbar'</span></div><div class="line">  &#125;);</div><div class="line">&#125;);</div><div class="line"> </div><div class="line">stateV1 === stateV2; <span class="comment">// false  </span></div><div class="line">stateV1.getIn([<span class="string">'users'</span>, <span class="number">0</span>]) === stateV2.getIn([<span class="string">'users'</span>, <span class="number">0</span>]); <span class="comment">// true  </span></div><div class="line">stateV1.getIn([<span class="string">'users'</span>, <span class="number">1</span>]) === stateV2.getIn([<span class="string">'users'</span>, <span class="number">1</span>]); <span class="comment">// false</span></div></pre></td></tr></table></figure><p>feWorkflow项目中使用最多的是<code>List</code>来创建一个数组，<code>Map()</code>来创建一个对象，再通过<code>set</code>的方法来更新数组，例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; List, <span class="built_in">Map</span> &#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> syncFolder = List([</div><div class="line">  <span class="built_in">Map</span>(&#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'syncFromFolder'</span>,</div><div class="line">    <span class="attr">label</span>: <span class="string">'从目录复制'</span>,</div><div class="line">    <span class="attr">location</span>: <span class="string">''</span></div><div class="line">  &#125;),</div><div class="line">  <span class="built_in">Map</span>(&#123;</div><div class="line">    <span class="attr">name</span>: <span class="string">'syncToFolder'</span>,</div><div class="line">    <span class="attr">label</span>: <span class="string">'复制到目录'</span>,</div><div class="line">    <span class="attr">location</span>: <span class="string">''</span></div><div class="line">  &#125;)</div><div class="line">]);</div></pre></td></tr></table></figure><p>更新的时候使用<code>setIn</code>方法，传递<code>Map</code>对象的序号，选中<code>location</code>这个属性，通过<code>action</code>传递过来的新值<code>action.location</code>更新值，并返回一个全新的数组。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">case</span> <span class="string">'SET_SYNC_FOLDER'</span>:</div><div class="line">      <span class="keyword">return</span> state.setIn([<span class="string">'syncFolder'</span>, action.index, <span class="string">'location'</span>], action.location);</div></pre></td></tr></table></figure><h4 id="数据存储" class="post-heading"><a href="#数据存储" class="headerlink" title="数据存储:"></a>数据存储:<a class="post-anchor" href="#数据存储" aria-hidden="true"></a></h4><p><strong>存：</strong></p><p>immutable的数据已经不是单纯的json数据格式，当我们要做json格式的数据存储的时候，可以使用<code>toJS()</code>方法抛出js对象，并通过<code>JSON.stringnify()</code>将js数据转换成json字符串，存入localstorage中。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> saveState = <span class="function">(<span class="params">name = <span class="string">'state'</span>, state = <span class="string">'state'</span></span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">const</span> data = <span class="built_in">JSON</span>.stringify(state.toJS());</div><div class="line">    localStorage.setItem(name, data);</div><div class="line">  &#125; <span class="keyword">catch</span>(err) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'err'</span>, err);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><strong>取：</strong></p><p>读取本地的json格式数据后，当需要加载进页面，首先需要把这段json数据转换会immutable.js数据格式，<code>immutable</code>提供了<code>fromJS()</code>方法，将js对象和数组转换成immtable的<code>Maps</code>和<code>Lists</code>格式。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; fromJS, Iterable &#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> loadState = <span class="function">(<span class="params">name = <span class="string">'setting'</span></span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">const</span> data = localStorage.getItem(name);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (data === <span class="literal">null</span>) &#123;</div><div class="line">      <span class="keyword">return</span> <span class="literal">undefined</span>;</div><div class="line">    &#125;P</div><div class="line"></div><div class="line">    <span class="keyword">return</span> fromJS(<span class="built_in">JSON</span>.parse(data), (key, value) =&gt; &#123;</div><div class="line">      <span class="keyword">const</span> isIndexed = Iterable.isIndexed(value);</div><div class="line">      <span class="keyword">return</span> isIndexed ? value.toList() : value.toMap();</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">  &#125; <span class="keyword">catch</span>(err) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="literal">undefined</span>;</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><hr><h2 id="应用示例" class="post-heading"><a href="#应用示例" class="headerlink" title="应用示例"></a>应用示例<a class="post-anchor" href="#应用示例" aria-hidden="true"></a></h2><p>上文介绍了整个feWorkflow的UI技术实现方案，现在来介绍下实际上gulp在这里是如何工作的。</p><p><strong>思路</strong></p><p>我们知道<code>node</code>中调用<code>child_process</code>的<code>exec</code>可以执行系统命令，gulpfile.js本身会调用离自身最近的node_modules，而gulp提供了API可以通过flag的形式(—cwd)来执行不同的路径。以此为思路，以最简单的方式，在按钮上绑定执行状态（dev或者build，包括flag等），通过<code>exec</code>直接运行gulp file.js.</p><p><strong>实现</strong></p><p>当按钮点击的时候，判断是否在执行中，如果在执行中则杀掉进程，如果不在执行中则通过<code>exec</code>执行当前按钮状态的命令。然后扭转按钮的状态，等待下一次按钮点击。</p><p>命令模式如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> ListBtns = <span class="function">(<span class="params">&#123;btns, listId, listLocation, onProcess, cancelBuild, setSnackbar&#125;</span>) =&gt;</span> (</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"btn-group btn-group__right"</span>&gt;</span></span></div><div class="line">    &#123;</div><div class="line">      btns.map((btn, i) =&gt; (</div><div class="line">        <span class="tag">&lt;<span class="name">RaisedButton</span></span></div><div class="line">          <span class="attr">key</span>=<span class="string">&#123;i&#125;</span></div><div class="line">          <span class="attr">className</span>=<span class="string">"btn"</span></div><div class="line">          <span class="attr">style</span>=<span class="string">&#123;style&#125;</span></div><div class="line">          <span class="attr">label</span>=<span class="string">&#123;btn.get(</span>'<span class="attr">name</span>')&#125;</div><div class="line">          <span class="attr">labelPosition</span>=<span class="string">"after"</span></div><div class="line">          <span class="attr">primary</span>=<span class="string">&#123;btn.get(</span>'<span class="attr">process</span>')&#125;</div><div class="line">          <span class="attr">secondary</span>=<span class="string">&#123;btn.get(</span>'<span class="attr">fail</span>')&#125;</div><div class="line">          <span class="attr">pid</span>=<span class="string">&#123;btn.get(</span>'<span class="attr">pid</span>')&#125;</div><div class="line">          <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt; &#123;</div><div class="line">            if (btn.get('process')) &#123;</div><div class="line">              kill(btn.get('pid'));</div><div class="line">            &#125; else &#123;</div><div class="line">              let child = exec(`gulp $&#123;btn.get('cmd')&#125; --cwd $&#123;listLocation&#125; $&#123;btn.get('flag')&#125; --gulpfile $&#123;cwd&#125;/gulpfile.js`,  &#123;</div><div class="line">                cwd</div><div class="line">              &#125;);</div><div class="line"></div><div class="line">              child.stderr.on('data', function (data) &#123;</div><div class="line">                let str = data.toString();</div><div class="line"></div><div class="line">                console.error('exec error: ' + str);</div><div class="line">                kill(btn.get('pid'));</div><div class="line">                cancelBuild(listId, i, btn.get('name'), child.pid, str, true);</div><div class="line">                dialog.showErrorBox('Oops， 出错了', str);</div><div class="line">              &#125;);</div><div class="line"></div><div class="line">              child.stdout.on('data', function (data) &#123;</div><div class="line">                console.log(data.toString())</div><div class="line">                onProcess(listId, i, btn.get('text'), child.pid, data.toString())</div><div class="line">              &#125;);</div><div class="line"></div><div class="line">              //关闭</div><div class="line">              child.stdout.on('close', function () &#123;</div><div class="line">                cancelBuild(listId, i, btn.get('name'), child.pid, '编译结束', false);</div><div class="line">                setSnackbar('编译结束');</div><div class="line"></div><div class="line">                console.info('编译结束');</div><div class="line">              &#125;);</div><div class="line">            &#125;</div><div class="line">          &#125;&#125;</div><div class="line">        /&gt;</div><div class="line">      ))</div><div class="line">    &#125;</div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">);</div></pre></td></tr></table></figure><p><code>—cwd</code>把gulp的操作路径指向了我们定义的src路径，<code>—gulpfile</code>则强行使用feWorkflow中封装的gulp file.js。我在js中对路径做了处理，以<code>src</code>做为截断点，拼接命令行，假设拖放了一个位于<code>D:\Code\work\vd\lottery\v3\src</code>下的路径，那么输出的命令格式为:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//执行命令</span></div><div class="line"><span class="keyword">let</span> child = exec(<span class="string">`gulp <span class="subst">$&#123;btn.get(<span class="string">'cmd'</span>)&#125;</span> --cwd <span class="subst">$&#123;listLocation&#125;</span> <span class="subst">$&#123;btn.get(<span class="string">'flag'</span>)&#125;</span> --gulpfile <span class="subst">$&#123;cwd&#125;</span>/gulpfile.js`</span>)</div><div class="line"></div><div class="line"><span class="comment">//编译输出命令：</span></div><div class="line">gulp dev --cwd D:\Code\work\vd\lottery\v3\src --development</div></pre></td></tr></table></figure><p>同时，通过<code>action</code>扭转了按钮状态：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">processing</span>(<span class="params">id, index, name, pid, data</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    id,</div><div class="line">    <span class="attr">type</span>: <span class="string">'PROCESSING'</span>,</div><div class="line">    <span class="attr">btns</span>: &#123;</div><div class="line">      index,</div><div class="line">      name,</div><div class="line">      pid,</div><div class="line">      data,</div><div class="line">      <span class="attr">process</span>: <span class="literal">true</span>,</div><div class="line">      <span class="attr">cmd</span>: name</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>调用<code>dispatch</code>发送给<code>reducer</code>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> initState = List([]);</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state = initState, action) =&gt; &#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    ...</div><div class="line">      case <span class="string">'PROCESSING'</span>:</div><div class="line">      <span class="keyword">return</span> state.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</div><div class="line">        <span class="keyword">if</span> (item.get(<span class="string">'id'</span>) == action.id) &#123;</div><div class="line">          <span class="keyword">return</span> item.withMutations(<span class="function"><span class="params">i</span> =&gt;</span> &#123;</div><div class="line">            i</div><div class="line">              .set(<span class="string">'status'</span>, action.btns.cmd)</div><div class="line">              .set(<span class="string">'snackbar'</span>, action.snackbar)</div><div class="line">              .setIn([<span class="string">'btns'</span>, action.btns.index, <span class="string">'text'</span>], action.btns.name)</div><div class="line">              .setIn([<span class="string">'btns'</span>, action.btns.index, <span class="string">'name'</span>], <span class="string">'编译中...'</span>)</div><div class="line">              .setIn([<span class="string">'btns'</span>, action.btns.index, <span class="string">'process'</span>], action.btns.process)</div><div class="line">              .setIn([<span class="string">'btns'</span>, action.btns.index, <span class="string">'pid'</span>], action.btns.pid);</div><div class="line">          &#125;);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">          <span class="keyword">return</span> item;</div><div class="line">        &#125;</div><div class="line">      &#125;);</div><div class="line">     ...</div></pre></td></tr></table></figure><p>这样，就是整个文件执行的过程。</p><hr><h2 id="写在最后" class="post-heading"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后<a class="post-anchor" href="#写在最后" aria-hidden="true"></a></h2><p>这次的改版做了很多新的尝试，断断续续的花了不少时间，还没有达到最初的设想，也还缺失了一些重要的功能。后续还需要补充不少东西。成品确实还比较简单，代码也许也比较杂乱，所有代码开源在<a href="https://github.com/whatifhappen/feWorkflow" target="_blank" rel="external">github</a>上，欢迎斧正。</p><p>参考资料：</p><ol><li><a href="https://github.com/electron/electron/tree/master/docs-translations/zh-CN" target="_blank" rel="external">electron docs</a></li><li><a href="https://babeljs.io/blog/2015/06/07/react-on-es6-plus" target="_blank" rel="external">babel react-on-es6-plus</a></li><li><a href="https://webpack.github.io/" target="_blank" rel="external">webpack</a></li><li><a href="http://redux.js.org/" target="_blank" rel="external">redux</a></li></ol><div class="post-tags" style="display:none"><a href="/tags/React/">React</a> <a href="/tags/Electron/">Electron</a></div><div class="post-categories" style="display:none"><a href="/cates/NodeJS/">NodeJS</a></div><div class="post-announce">感谢您的阅读，本文由 <a href="https://github.com/whatifhappen">whatifhappen</a> 原创提供。如若转载，请注明出处：凹凸实验室（<a href="/notes/2016/07/05/fe-workflow/">https://aotu.io/notes/2016/07/05/fe-workflow/</a>）</div><div class="post-revision"><i class="fa fa-clock-o"></i> <time class="post-updated" datetime="2016-10-20T07:06:32.427Z">上次更新：2016-10-20 15:06:32</time></div></div><div class="post-nav"><div class="post-nav-next"><a href="/notes/2016/07/09/SVG-Symbol-component-practice/" title="拥抱Web设计新趋势：SVG Sprites实践应用">拥抱Web设计新趋势：SVG Sprites实践应用 <i class="fa fa-chevron-right"></i></a></div><div class="post-nav-prev"><a href="/notes/2016/07/03/HIFSD2-Summary/" title="第二界HiFSD分享会PPT讲义下载分享"><i class="fa fa-chevron-left"></i> 第二界HiFSD分享会PPT讲义下载分享</a></div></div><div class="post-comments" id="comments"><div class="ds-thread" data-thread-key="bm90ZXMvMjAxNi8wNy8wNS9mZS13b3JrZmxvdy8=" data-title="feWorkflow - 使用electron, react, redux, immutable构建桌面App" data-url="https://aotu.io/notes/2016/07/05/fe-workflow/index.html"></div><script type="text/javascript">var duoshuoQuery={short_name:"aotu"};!function(){var t=document.createElement("script");t.id="duoshuo-script",t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script></div></article></div><aside class="mod-side" id="sidebar"><div class="mod-side-sec aotuwx"><img class="aotuwx-qrcode" src="/img/qrcode.jpg" alt="关注我们"><div class="aotuwx-slogan">每周五推送精选技术文章</div></div><div class="mod-side-sec works"><div class="mod-side-sec-hd"><h2>服务/产品</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="//cases.aotu.io/mobi/maga.html" target="_blank" title="拇指期刊">拇指期刊</a></li><li><a href="//athena.aotu.io/" target="_blank" title="Athena">Athena</a></li><li><a href="//guide.aotu.io/" target="_blank" title="前端代码规范">前端代码规范</a></li><li><a href="//halojs.aotu.io/" target="_blank" title="HaloJS">HaloJS</a></li><li><a href="//sign.aotu.io/" target="_blank" title="邮件签名工具">邮件签名工具</a></li><li><a href="//mac.aotu.io/" target="_blank" title="MAC全栈环境">MAC全栈环境</a></li></ul></div></div><div class="mod-side-sec favlinks"><div class="mod-side-sec-hd"><h2>友情链接</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="https://jdc.jd.com" target="_blank" title="京东设计中心">JDC京东设计中心</a></li><li><a href="http://fex.baidu.com" target="_blank" title="百度Web前端研发部">百度FEX</a></li><li><a href="http://taobaofed.org" target="_blank" title="淘宝前端团队">淘宝FED</a></li><li><a href="http://tgideas.qq.com" target="_blank" title="腾讯互娱设计中心">TGIdeas</a></li><li><a href="http://isux.tencent.com" target="_blank" title="腾讯SNG设计中心">ISUX</a></li><li><a href="http://cdc.tencent.com" target="_blank" title="腾讯用户研究与体验设计中心">CDC</a></li><li><a href="http://ued.ctrip.com" target="_blank" title="携程设计委员会">携程UED</a></li></ul></div></div></aside></div></div><div class="mod-backtop" id="backTop"><i class="fa fa-long-arrow-up"></i></div><footer class="mod-ft" id="footer"><div class="grid"><ul class="mod-ft-links"><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li><li><a href="https://github.com/o2team/o2team.github.io" target="_blank"><i class="fa fa-github-alt"></i></a></li></ul><div class="mod-ft-sec mod-ft-copyright"><p>Designed by <a href="http://aotu.io" target="_blank">凹凸实验室</a> @<a target="_blank" href="http://jdc.jd.com">京东用户体验设计部</a></p><p>Copyright &copy; 2016. All Rights Reserved.</p><p><a href="http://www.miibeian.gov.cn/" target="_blank">粤ICP备15077732号-2</a></p></div></div></footer><script src="/js/bundle/core.js"></script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e850b980d029480b092fdd7503c3f8de";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><style>#cnzz_stat_icon_1258539944{display:none}</style><script type="text/javascript">var cnzz_protocol="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cspan id='cnzz_stat_icon_1258539944'%3E%3C/span%3E%3Cscript src='"+cnzz_protocol+"s11.cnzz.com/z_stat.php%3Fid%3D1258539944' type='text/javascript'%3E%3C/script%3E"))</script></body></html>