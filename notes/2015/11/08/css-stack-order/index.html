<!DOCTYPE html><html class="theme-lattice"><head><meta charset="utf-8"><title>css层叠顺序探究 | Aotu.io「凹凸实验室」</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="author" content="凹凸实验室"><meta name="designer" content="凹凸实验室"><meta name="rating" content="general"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="index, follow"><meta name="keywords" content="CSS,凹凸实验室,Aotu,前端开发,全栈开发,IOS开发,Android开发"><link rel="canonical" href="https://aotu.io/notes/2015/11/08/css-stack-order/index.html"><link rel="apple-touch-icon" sizes="57x57" href="/img/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="114x114" href="/img/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="72x72" href="/img/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="144x144" href="/img/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="60x60" href="/img/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="120x120" href="/img/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="152x152" href="/img/apple-touch-icon-152x152.png"><link rel="icon" type="image/png" href="/img/favicon-230x230.png" sizes="230x230"><link rel="icon" type="image/png" href="/img/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16"><link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32"><meta name="msapplication-TileColor" content="#2f83cd"><meta name="msapplication-TileImage" content="/img/mstile-144x144.png"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" href="/atom.xml" title="Aotu.io"><meta name="description" content="嗯~一个比较基础但容易混乱的知识点~首先上一大段文绉绉的w3c规范以表明这是一篇严肃的学术文章（觉得太长可先跳过~）：

In CSS 2.1, each box has a position in three dimensions. In addition to their horizontal and vertical positions, boxes lie along a “z-axis”"><meta property="og:type" content="article"><meta property="og:title" content="css层叠顺序探究"><meta property="og:url" content="https://aotu.io/notes/2015/11/08/css-stack-order/index.html"><meta property="og:site_name" content="Aotu.io"><meta property="og:description" content="嗯~一个比较基础但容易混乱的知识点~首先上一大段文绉绉的w3c规范以表明这是一篇严肃的学术文章（觉得太长可先跳过~）：

In CSS 2.1, each box has a position in three dimensions. In addition to their horizontal and vertical positions, boxes lie along a “z-axis”"><meta property="og:image" content="https://aotu.io//img.aotu.io/Yettyzyt/1-1-normal-order.png"><meta property="og:image" content="https://aotu.io//img.aotu.io/Yettyzyt/1-2-change-order.png"><meta property="og:image" content="https://aotu.io//img.aotu.io/Yettyzyt/2-1-normal-order.png"><meta property="og:image" content="https://aotu.io//img.aotu.io/Yettyzyt/2-2-change-order.png"><meta property="og:image" content="https://aotu.io//img.aotu.io/Yettyzyt/3-1-summay-order.png"><meta property="og:image" content="https://aotu.io//img.aotu.io/Yettyzyt/4-1-normal-order.png"><meta property="og:image" content="https://aotu.io//img.aotu.io/Yettyzyt/4-2-ie-bug.png"><meta property="og:image" content="https://aotu.io//img.aotu.io/Yettyzyt/4-3-opacity-order.png"><meta property="og:updated_time" content="2016-10-20T07:06:32.403Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="css层叠顺序探究"><meta name="twitter:description" content="嗯~一个比较基础但容易混乱的知识点~首先上一大段文绉绉的w3c规范以表明这是一篇严肃的学术文章（觉得太长可先跳过~）：

In CSS 2.1, each box has a position in three dimensions. In addition to their horizontal and vertical positions, boxes lie along a “z-axis”"><meta name="twitter:image" content="https://aotu.io//img.aotu.io/Yettyzyt/1-1-normal-order.png"><meta name="twitter:site" content="o2circle"><script>var App={root:"/",isHome:!1,isCate:!1,isTag:!1}</script></head><body class="page-post-detail"><div class="mod-hd"><div class="grid"><div class="mod-logo"><a href="/index.html" title="Aotu.io">Aotu.io</a></div><span class="mod-hd-toggle" id="J_hdToggle"><i class="fa fa-bars"></i></span><div class="mod-hd-main"><div class="mod-hd-inner"><nav class="mod-nav"><ul class="mod-nav-list"><li class="main-nav-item"><a href="/index.html" class="main-nav-link">首页</a></li><li class="main-nav-item"><a href="/about/" class="main-nav-link">关于</a></li><li class="main-nav-item"><a href="/join/" class="main-nav-link">加入我们</a></li></ul></nav><div class="mod-search"><a class="fa fa-search mod-search-ico" id="J_searchTrigger" title="搜索"></a><form id="J_searchForm" method="get" class="mod-search-form" action="/search/"><input type="text" name="query" class="mod-search-ipt" id="J_searchInput" placeholder="搜索"></form></div></div></div></div></div><div class="mod-container"><div class="grid"><div class="mod-main"><article class="post"><header class="post-hd"><h2 class="post-tit">css层叠顺序探究</h2><div class="post-meta">by <a target="_blank" href="https://github.com/Yettyzyt" class="post-author">燕婷</a> on <span>2015-11-08</span></div><p class="post-subtit" style="display:none"><i class="fa fa-quote-left"></i>A stacking context is formed, anywhere in the document, by any element which is either</p><span style="display:none" id="busuanzi_value_page_pv"></span></header><div class="post-cover"><img src="//img.aotu.io/Yettyzyt/cover.png" alt="css层叠顺序探究"></div><div class="post-content"><p>嗯~一个比较基础但容易混乱的知识点~<br>首先上一大段文绉绉的w3c规范以表明这是一篇严肃的学术文章（觉得太长可先跳过~）：</p><blockquote><p>In CSS 2.1, each box has a position in three dimensions. In addition to their horizontal and vertical positions, boxes lie along a “z-axis” and are formatted one on top of the other. Z-axis positions are particularly relevant when boxes overlap visually.<br>The order in which the rendering tree is painted onto the canvas is described in terms of stacking contexts. Stacking contexts can contain further stacking contexts. A stacking context is atomic from the point of view of its parent stacking context; boxes in other stacking contexts may not come between any of its boxes.<br>Each box belongs to one stacking context. Each positioned box in a given stacking context has an integer stack level, which is its position on the z-axis relative other stack levels within the same stacking context. Boxes with greater stack levels are always formatted in front of boxes with lower stack levels. Boxes may have negative stack levels. Boxes with the same stack level in a stacking context are stacked back-to-front according to document tree order.<br>——<a href="http://www.w3.org/TR/CSS2/visuren.html#propdef-z-index" target="_blank" rel="external">W3C</a></p></blockquote><p>其实说人话，大致意思就是：<br><strong>每个盒模型的位置是三维的，除了x轴和y轴，还有一个表示层叠的z轴；<br>z轴上的位置决定了我们看到的盒模型之间的层叠效果（谁盖住谁）。</strong></p><p>上述规范还解释了层叠上下文的特点以及盒模型的层叠级别，下面我们通过栗子慢慢探究。</p><h2 id="1-浮动与行内" class="post-heading"><a href="#1-浮动与行内" class="headerlink" title="1. 浮动与行内"></a>1. 浮动与行内<a class="post-anchor" href="#1-浮动与行内" aria-hidden="true"></a></h2><p><em>eg.1-1/eg.1-2共同结构与样式：</em><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div3"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div4"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div5"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure><p></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">div</span>&#123;<span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#000</span> dashed;<span class="attribute">height</span>:<span class="number">200px</span>;<span class="attribute">width</span>:<span class="number">300px</span>;<span class="attribute">text-align</span>: center;&#125;</div><div class="line"><span class="selector-class">.div1</span>&#123;<span class="attribute">background-color</span>: <span class="number">#FF4363</span>;<span class="attribute">margin</span>:<span class="number">0</span> <span class="number">0</span>;&#125;</div><div class="line"><span class="selector-class">.div2</span>&#123;<span class="attribute">background-color</span>: <span class="number">#FC9D99</span>;<span class="attribute">margin</span>:-<span class="number">170px</span> <span class="number">20px</span>;&#125;</div><div class="line"><span class="selector-class">.div3</span>&#123;<span class="attribute">background-color</span>: <span class="number">#F9CCAD</span>;<span class="attribute">margin</span>:-<span class="number">160px</span> <span class="number">40px</span>;&#125;</div><div class="line"><span class="selector-class">.div4</span>&#123;<span class="attribute">background-color</span>: <span class="number">#C7C7A8</span>;<span class="attribute">margin</span>:-<span class="number">150px</span> <span class="number">60px</span>;&#125;</div><div class="line"><span class="selector-class">.div5</span>&#123;<span class="attribute">background-color</span>: <span class="number">#84AF9B</span>;<span class="attribute">margin</span>:-<span class="number">140px</span> -<span class="number">10px</span>;&#125;</div></pre></td></tr></table></figure><hr><p><em>eg.1-1：常规流中非定位非行内元素的层叠情况</em><br><img src="//img.aotu.io/Yettyzyt/1-1-normal-order.png" alt="层叠情况"></p><p><strong>结论： 常规流中非定位非行内的元素根据html顺序，按照“后来居上”的规则层叠。</strong></p><hr><p><em>eg.1-2：定位元素／行内元素／浮动元素之间的层叠关系</em><br><img src="//img.aotu.io/Yettyzyt/1-2-change-order.png" alt="zindex"></p><p><strong>结论： 层叠顺序如下（高➡低）：<br>z-index为auto的定位元素；<br>常规流内行内非定位元素；<br>非定位的浮动元素；<br>常规流内非行内非定位元素；<br>z-index为负的定位元素。</strong></p><h2 id="2-为定位元素设置z-index" class="post-heading"><a href="#2-为定位元素设置z-index" class="headerlink" title="2. 为定位元素设置z-index"></a>2. 为定位元素设置z-index<a class="post-anchor" href="#2-为定位元素设置z-index" aria-hidden="true"></a></h2><p>首先，你必须了解以下两点：</p><ul><li>每个定位元素都有一个整型的层叠级别（stack level）；</li><li>z-index属性只对定位元素有效。</li></ul><hr><p><em>eg.2-1/eg.2-2共同结构与样式：</em><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div1"</span> <span class="attr">style</span>=<span class="string">"position:relative"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div2"</span> <span class="attr">style</span>=<span class="string">"position:relative"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div3"</span> <span class="attr">style</span>=<span class="string">"position:relative"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div4"</span> <span class="attr">style</span>=<span class="string">"position:relative"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div5"</span> <span class="attr">style</span>=<span class="string">"position:relative"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure><p></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">div</span>&#123;<span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#000</span> dashed;<span class="attribute">height</span>:<span class="number">200px</span>;<span class="attribute">width</span>:<span class="number">300px</span>;<span class="attribute">text-align</span>: center;&#125;</div><div class="line"><span class="selector-class">.div1</span>&#123;<span class="attribute">background-color</span>: <span class="number">#FF4363</span>;<span class="attribute">margin</span>:<span class="number">0</span> <span class="number">0</span>;&#125;</div><div class="line"><span class="selector-class">.div2</span>&#123;<span class="attribute">background-color</span>: <span class="number">#FC9D99</span>;<span class="attribute">margin</span>:-<span class="number">170px</span> <span class="number">20px</span>;&#125;</div><div class="line"><span class="selector-class">.div3</span>&#123;<span class="attribute">background-color</span>: <span class="number">#F9CCAD</span>;<span class="attribute">margin</span>:-<span class="number">160px</span> <span class="number">40px</span>;&#125;</div><div class="line"><span class="selector-class">.div4</span>&#123;<span class="attribute">background-color</span>: <span class="number">#C7C7A8</span>;<span class="attribute">margin</span>:-<span class="number">150px</span> <span class="number">60px</span>;&#125;</div><div class="line"><span class="selector-class">.div5</span>&#123;<span class="attribute">background-color</span>: <span class="number">#84AF9B</span>;<span class="attribute">margin</span>:-<span class="number">140px</span> -<span class="number">10px</span>;&#125;</div></pre></td></tr></table></figure><hr><p><em>eg.2-1: 5个定位元素在未设置z-index时的层叠情况</em><br><img src="//img.aotu.io/Yettyzyt/2-1-normal-order.png" alt="z-index"></p><p><strong>结论： z-index为auto的定位元素根据html顺序，按照“后来居上”的规则层叠。</strong></p><hr><p><em>eg.2-2: 5个定位元素设置不同z-index时的层叠情况</em><br><img src="//img.aotu.io/Yettyzyt/2-2-change-order.png" alt="z-index"></p><p><strong>结论：<br>定位元素的层叠级别由z-index的值决定，z-index为auto则其层叠级别为0（注意：只是层级为0，其z-index值仍为auto）；<br>同一层叠上下文中，层叠级别大的元素位于层叠级别小的元素之上；<br>同一层叠上下文中，层叠级别相同的元素根据html顺序决定元素的层叠关系，遵循“后来居上”原则。</strong></p><h2 id="3-层叠顺序（stack-order）" class="post-heading"><a href="#3-层叠顺序（stack-order）" class="headerlink" title="3. 层叠顺序（stack order）"></a>3. 层叠顺序（stack order）<a class="post-anchor" href="#3-层叠顺序（stack-order）" aria-hidden="true"></a></h2><p>结合上面的例子进行总结，可得每一个层叠上下文内的层叠顺序：</p><blockquote><p>Within each stacking context, the following layers are painted in back-to-front order:</p><ol><li>the background and borders of the element forming the stacking context.</li><li>the child stacking contexts with negative stack levels (most negative first).</li><li>the in-flow, non-inline-level, non-positioned descendants.</li><li>the non-positioned floats.</li><li>the in-flow, inline-level, non-positioned descendants, including inline tables and inline blocks.</li><li>the child stacking contexts with stack level 0 and the positioned descendants with stack level 0.</li><li>the child stacking contexts with positive stack levels (least positive first).<br>—<a href="http://www.w3.org/TR/CSS2/visuren.html#propdef-z-index" target="_blank" rel="external">W3C</a></li></ol></blockquote><p>规范中的描述比较乏味，可结合<a href="http://www.w3help.org/zh-cn/kb/013" target="_blank" rel="external">w3help</a>中的一张图片进行理解：</p><blockquote><p><img src="//img.aotu.io/Yettyzyt/3-1-summay-order.png" alt="z-index"></p></blockquote><h2 id="4-层叠上下文（stacking-context）" class="post-heading"><a href="#4-层叠上下文（stacking-context）" class="headerlink" title="4. 层叠上下文（stacking context）"></a>4. 层叠上下文（stacking context）<a class="post-anchor" href="#4-层叠上下文（stacking-context）" aria-hidden="true"></a></h2><p>看完上述的例子，对于层叠顺序应该大致了解了。但突然冒出一个“层叠上下文”，这又是个什么鬼？</p><h3 id="4-1-层叠上下文的特点" class="post-heading"><a href="#4-1-层叠上下文的特点" class="headerlink" title="4.1 层叠上下文的特点"></a>4.1 层叠上下文的特点<a class="post-anchor" href="#4-1-层叠上下文的特点" aria-hidden="true"></a></h3><blockquote><ol><li>stacking context可以嵌套</li><li>每个stacking context相对于兄弟元素是完全独立的，其内部规则不会影响到外部</li><li>每个stacking context元素都会被父stacking context当做一个元素施加stacking规则<br>——<a href="http://blog.angular.in/css-stacking-contextli-na-xie-xian-wei-ren-zhi-de-keng/" target="_blank" rel="external">Abruzzi</a></li></ol></blockquote><h3 id="4-2-层叠上下文的创建" class="post-heading"><a href="#4-2-层叠上下文的创建" class="headerlink" title="4.2 层叠上下文的创建"></a>4.2 层叠上下文的创建<a class="post-anchor" href="#4-2-层叠上下文的创建" aria-hidden="true"></a></h3><h4 id="4-2-1-css2" class="post-heading"><a href="#4-2-1-css2" class="headerlink" title="4.2.1 css2"></a>4.2.1 css2<a class="post-anchor" href="#4-2-1-css2" aria-hidden="true"></a></h4><blockquote><p>The root element forms the root stacking context. Other stacking contexts are generated by any positioned element (including relatively positioned elements) having a computed value of ‘z-index’ other than ‘auto’. Stacking contexts are not necessarily related to containing blocks.<br>——<a href="http://www.w3.org/TR/CSS2/visuren.html#propdef-z-index" target="_blank" rel="external">W3C</a></p></blockquote><p><strong>CSS2中规定创建层叠上下文的两种情况：<br>根元素（html）；<br>定位元素（absolute/relative）且z-index的值不为auto。</strong></p><p>注：在同一层叠上下文中，父元素、子元素与自身都被当作是并级关系进行层叠级别的比较。他们之间可能互相层叠。</p><hr><p><em>eg.4-1：z-index为auto的定位元素没有创建层叠上下文</em><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div1"</span> <span class="attr">style</span>=<span class="string">"position:relative"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div1_1"</span> <span class="attr">style</span>=<span class="string">"position:relative;z-index:9"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"div2"</span> <span class="attr">style</span>=<span class="string">"position:relative"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure><p></p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">div</span>&#123;<span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#000</span> dashed;<span class="attribute">height</span>:<span class="number">200px</span>;<span class="attribute">width</span>:<span class="number">400px</span>;<span class="attribute">text-align</span>: center;&#125;</div><div class="line"><span class="selector-class">.div1</span>&#123;<span class="attribute">background-color</span>: <span class="number">#FF4363</span>;&#125;</div><div class="line"><span class="selector-class">.div1_1</span>&#123;<span class="attribute">background-color</span>: <span class="number">#FC9D99</span>;<span class="attribute">margin</span>:<span class="number">100px</span> <span class="number">0</span> <span class="number">0</span> <span class="number">50px</span>;<span class="attribute">width</span>: <span class="number">300px</span>;&#125;</div><div class="line"><span class="selector-class">.div2</span>&#123;<span class="attribute">background-color</span>: <span class="number">#F9CCAD</span>;<span class="attribute">line-height</span>: <span class="number">300px</span>;&#125;</div></pre></td></tr></table></figure><p><img src="//img.aotu.io/Yettyzyt/4-1-normal-order.png" alt="z-index"><br>分析上述例子：</p><ul><li><strong>前提：</strong>div1、div1_1、div2都是定位元素；div1、div2都没有设置z-index值。</li><li><strong>假设：</strong>div1与div2创建了层叠上下文。不同层叠上下文之间是相对独立的，div1_1属于div1所创建的层叠上下文，与div2所创建的层叠上下文无关；根据“后来居上”原则，则div2应该在div1及其子元素div1_1之上。</li><li><strong>由上述例子可得：</strong>div1的子元素div1_1在div2之上。</li><li><strong>因此：</strong>div1、div2没有创建层叠上下文。</li></ul><p><strong>结论： z-index为auto的定位元素不会创建新的层叠上下文。</strong></p><hr><p><strong>IE中的BUG：</strong><br><em>在IE6-7浏览器中测试eg.4-1：</em><br><img src="//img.aotu.io/Yettyzyt/4-2-ie-bug.png" alt="zindex"></p><p><strong>结论： ie6-7中，z-index为auto的定位元素也会创建新的层叠上下文。</strong></p><h4 id="4-2-2-css3" class="post-heading"><a href="#4-2-2-css3" class="headerlink" title="4.2.2 css3"></a>4.2.2 css3<a class="post-anchor" href="#4-2-2-css3" aria-hidden="true"></a></h4><blockquote><p>A stacking context is formed, anywhere in the document, by any element which is either</p><ul><li>the root element (HTML),</li><li>positioned (absolutely or relatively) with a z-index value other than “auto”,</li><li>a flex item with a z-index value other than “auto”,that is the parent element display: flex|inline-flex,</li><li>elements with an opacity value less than 1. (See the specification for opacity),</li><li>elements with a transform value other than “none”,</li><li>elements with a mix-blend-mode value other than “normal”,</li><li>elements with a filter value other than “none”,</li><li>elements with isolation set to “isolate”,</li><li>position: fixed</li><li>specifying any attribute above in will-change even if you don’t specify values for these attributes directly (See this post)</li><li>elements with -webkit-overflow-scrolling set to “touch”<br>——<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context" target="_blank" rel="external">MDN</a></li></ul></blockquote><p><strong>CSS3中规定创建层叠上下文的十种情况：</strong></p><ul><li><strong>根元素 (HTML)</strong></li><li><strong>绝对（absolute）定位或相对（relative）定位且 z-index 值不为”auto”</strong></li><li><strong>一个 flex 项目(flex item)，且 z-index 值不为 “auto”，也就是父元素 display: flex|inline-flex</strong></li><li><strong>元素的 opacity 属性值小于 1（参考 the specification for opacity）</strong></li><li><strong>元素的 transform 属性值不为 “none”</strong></li><li><strong>元素的 mix-blend-mode 属性值不为 “normal”</strong></li><li><strong>元素的 isolation 属性被设置为 “isolate”</strong></li><li><strong>在 mobile WebKit 和 Chrome 22+ 内核的浏览器中，position: fixed 总是创建一个新的层叠上下文, 即使 z-index 的值是 “auto”</strong></li><li><strong>在 will-change 中指定了任意 CSS 属性，即便你没有定义该元素的这些属性</strong></li><li><strong>元素的 -webkit-overflow-scrolling 属性被设置 “touch”</strong></li></ul><hr><p><em>eg.4-2：opacity创建新的层叠上下文</em><br><img src="//img.aotu.io/Yettyzyt/4-3-opacity-order.png" alt="z-index"><br>分析：</p><blockquote><p>If an element with opacity less than 1 is not positioned, implementations must paint the layer it creates, within its parent stacking context, at the same stacking order that would be used if it were a positioned element with ‘z-index: 0’ and ‘opacity: 1’.<br>If an element with opacity less than 1 is positioned, the ‘z-index’ property applies as described in [CSS21], except that ‘auto’ is treated as ‘0’ since a new stacking context is always created.<br>——<a href="http://www.w3.org/TR/css3-color/#transparency" target="_blank" rel="external">W3C</a></p></blockquote><p><strong>结论：<br>如果元素设置opacity小于1但未定位，视为css2中元素定位／z-index:0且opacity:1的情况；<br>如果元素设置opacity小于1且定位，z-index为auto，视为css2中元素定位且z-index:0的情况；<br>如果元素设置opacity小于1且定位，z-index不为auto，则根据css2的描述层叠。</strong><br>（其他CSS3创建层叠上下文的元素情况与opacity相同，故不赘述。）</p><hr><p>至此，应该能够明白：</p><ul><li>根元素（html）会创建一个新的层叠上下文；</li><li>上述CSS2／CSS3中的元素会创建新的层叠上下文；</li><li>在每一个层叠上下文中都遵循上文中提到的层叠顺序；</li><li>每一个层叠上下文（除根元素）在它的父层叠上下文中都以一个普通元素来对待，其内部的层叠规则不影响其本身在父层叠上下文（即其所属层叠上下文）中的层叠顺序。</li></ul><h3 id="4-3-层叠上下文的层级" class="post-heading"><a href="#4-3-层叠上下文的层级" class="headerlink" title="4.3 层叠上下文的层级"></a>4.3 层叠上下文的层级<a class="post-anchor" href="#4-3-层叠上下文的层级" aria-hidden="true"></a></h3><ul><li>z-index值为auto的层叠上下文（z-index未设置的定位元素）层级为0；</li><li>z-index值为0（根元素／z-index为0的定位元素／css3中提到的除根元素与定位元素之外的其他会创建层叠上下文的未定位或已定位无设置z-index的元素）的层叠上下文层级为0；</li><li>z-index值已设置且不为0的层叠上下文层级（z-index已设置且不为0的定位元素）与z-index的值相等；</li><li>相同层级的层叠上下文遵循“后来居上”的规则层叠。</li></ul><h2 id="5-小结" class="post-heading"><a href="#5-小结" class="headerlink" title="5. 小结"></a>5. 小结<a class="post-anchor" href="#5-小结" aria-hidden="true"></a></h2><ul><li><strong>属于同一层叠上下文的元素（无论它们在结构上是兄弟或父子，甚至是祖孙），都遵循上文所述的层叠顺序；</strong></li><li><strong>不同的层叠上下文之间，层级较大的层叠上下文元素及其内部元素位于层级小的层叠上下文元素及其内部元素之上；</strong></li><li><strong>不同的层叠上下文之间互相独立；</strong></li><li><strong>层叠上下文可嵌套，内部规则不影响外部。</strong></li></ul><div class="post-tags" style="display:none"><a href="/tags/CSS/">CSS</a></div><div class="post-categories" style="display:none"><a href="/cates/Web开发/">Web开发</a></div><div class="post-announce">感谢您的阅读，本文由 <a href="//aotu.io">凹凸实验室</a> 版权所有。如若转载，请注明出处：凹凸实验室（<a href="https://aotu.io/notes/2015/11/08/css-stack-order/">https://aotu.io/notes/2015/11/08/css-stack-order/</a>）</div><div class="post-revision"><i class="fa fa-clock-o"></i> <time class="post-updated" datetime="2016-10-20T07:06:32.403Z">上次更新：2016-10-20 15:06:32</time></div></div><div class="post-nav"><div class="post-nav-next"><a href="/notes/2015/11/11/phantomJs-crawler/" title="基于phantomJs的网络爬虫">基于phantomJs的网络爬虫 <i class="fa fa-chevron-right"></i></a></div><div class="post-nav-prev"><a href="/notes/2015/11/06/webp-responsive-image/" title="Service Workers：采用WebP动态响应图片"><i class="fa fa-chevron-left"></i> Service Workers：采用WebP动态响应图片</a></div></div><div class="post-comments" id="comments"><div class="ds-thread" data-thread-key="bm90ZXMvMjAxNS8xMS8wOC9jc3Mtc3RhY2stb3JkZXIv" data-title="css层叠顺序探究" data-url="https://aotu.io/notes/2015/11/08/css-stack-order/index.html"></div><script type="text/javascript">var duoshuoQuery={short_name:"aotu"};!function(){var t=document.createElement("script");t.id="duoshuo-script",t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script></div></article></div><aside class="mod-side" id="sidebar"><div class="mod-side-sec aotuwx"><img class="aotuwx-qrcode" src="/img/qrcode.jpg" alt="关注我们"><div class="aotuwx-slogan">每周五推送精选技术文章</div></div><div class="mod-side-sec works"><div class="mod-side-sec-hd"><h2>服务/产品</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="//cases.aotu.io/mobi/maga.html" target="_blank" title="拇指期刊">拇指期刊</a></li><li><a href="//athena.aotu.io/" target="_blank" title="Athena">Athena</a></li><li><a href="//guide.aotu.io/" target="_blank" title="前端代码规范">前端代码规范</a></li><li><a href="//halojs.aotu.io/" target="_blank" title="HaloJS">HaloJS</a></li><li><a href="//sign.aotu.io/" target="_blank" title="邮件签名工具">邮件签名工具</a></li><li><a href="//mac.aotu.io/" target="_blank" title="MAC全栈环境">MAC全栈环境</a></li></ul></div></div><div class="mod-side-sec favlinks"><div class="mod-side-sec-hd"><h2>友情链接</h2></div><div class="mod-side-sec-bd"><ul class="mod-side-list"><li><a href="https://jdc.jd.com" target="_blank" title="京东设计中心">JDC京东设计中心</a></li><li><a href="http://fex.baidu.com" target="_blank" title="百度Web前端研发部">百度FEX</a></li><li><a href="http://taobaofed.org" target="_blank" title="淘宝前端团队">淘宝FED</a></li><li><a href="http://tgideas.qq.com" target="_blank" title="腾讯互娱设计中心">TGIdeas</a></li><li><a href="http://isux.tencent.com" target="_blank" title="腾讯SNG设计中心">ISUX</a></li><li><a href="http://cdc.tencent.com" target="_blank" title="腾讯用户研究与体验设计中心">CDC</a></li><li><a href="http://ued.ctrip.com" target="_blank" title="携程设计委员会">携程UED</a></li></ul></div></div></aside></div></div><div class="mod-backtop" id="backTop"><i class="fa fa-long-arrow-up"></i></div><footer class="mod-ft" id="footer"><div class="grid"><ul class="mod-ft-links"><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li><li><a href="https://github.com/o2team/o2team.github.io" target="_blank"><i class="fa fa-github-alt"></i></a></li></ul><div class="mod-ft-sec mod-ft-copyright"><p>Designed by <a href="http://aotu.io" target="_blank">凹凸实验室</a> @<a target="_blank" href="http://jdc.jd.com">京东用户体验设计部</a></p><p>Copyright &copy; 2016. All Rights Reserved.</p><p><a href="http://www.miibeian.gov.cn/" target="_blank">粤ICP备15077732号-2</a></p></div></div></footer><script src="/js/bundle/core.js"></script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?e850b980d029480b092fdd7503c3f8de";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><style>#cnzz_stat_icon_1258539944{display:none}</style><script type="text/javascript">var cnzz_protocol="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cspan id='cnzz_stat_icon_1258539944'%3E%3C/span%3E%3Cscript src='"+cnzz_protocol+"s11.cnzz.com/z_stat.php%3Fid%3D1258539944' type='text/javascript'%3E%3C/script%3E"))</script></body></html>