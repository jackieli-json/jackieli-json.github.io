"use strict";!function(t){var a={};a.model=function(a,o){this.opts=o,this.$target=a,this.$scrollTarget=this.opts.$scrollTarget||a,this.$doc=t(document),this.isLoading=!1,this.pageData=o.pageData,this.noMorePage=!1,this.init()},a.model.prototype={init:function(){var a=this;t.fn.scrollPager.enable(this.$target),this.$scrollTarget.on("scroll.scroll_pager",debounce(function(t){return a.onScroll()},a.opts.scrollDebounce)),this.opts.loadDataOnInit&&this.loadData()},dispose:function(){this.$scrollTarget.off("scroll.scroll_pager"),this.$target.removeData("scrollpager")},onScroll:function(){if(!this.$target.data("scrollpager")||this.isLoading||this.noMorePage)return!1;var t=this.$scrollTarget.scrollTop()+this.opts.heightOffset>=this.$doc.height()-this.$scrollTarget.height();return!!t&&this.loadData()},_getUrl:function(){var t=this.opts.url;return"function"==typeof this.opts.url&&(t=t(this.pageData)),t},loadData:function(){if(this.pageData.p++,this.pageData.total<=this.pageData.p&&(this.noMorePage=!0,this.dispose()),this.pageData.total<this.pageData.p)return!1;this.opts.ajaxOpts.stringifyData&&this.opts.ajaxOpts.data&&(this.opts.ajaxOpts.data=t.extend(!0,this.opts.ajaxOpts.data,this.pageData),this.opts.ajaxOpts.data=JSON.stringify(this.opts.ajaxOpts.data)),this.isLoading=!0,this.opts.showLoading(),this.opts.beforeLoad&&this.opts.beforeLoad.call(this);var a=this,o=this._getUrl();this.jqXHR=t.ajax(o,this.opts.ajaxOpts).done(function(t,o,s){a.opts.afterLoad&&a.opts.afterLoad.call(this,!0,t)}).fail(function(t,o,s){a.log(o),a.opts.afterLoad&&a.opts.afterLoad.call(this,!1,{xhr:o,err:s,Title:"Server Error..."})}).always(function(t,o){a.isLoading=!1,a.opts.hideLoading()})},log:function(t){var a=window.console||{log:function(){}};a.log(t)}},t.fn.scrollPager=function(o){return o=t.extend(!0,{},t.fn.scrollPager.defaults,o),this.each(function(){new a.model(t(this),o)})},t.fn.scrollPager.defaults={url:null,beforeLoad:function(){},afterLoad:function(t,a){},showLoading:function(){},hideLoading:function(){},$scrollTarget:t(window),heightOffset:0,loadDataOnInit:!1,pageData:{p:0,ps:10,total:100},ajaxOpts:{dataType:"json",contentType:"application/json; charset=utf-8",type:"POST",data:{},stringifyData:!0},scrollDebounce:100},t.fn.scrollPager.disable=function(t){return t.data("scrollpager",!1)},t.fn.scrollPager.enable=function(t){return t.data("scrollpager",!0)}}(jQuery);